<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>吃啥</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/bootstrap-theme.min.css}" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" th:src="@{/js/jquery-2.1.4.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
    <script type="text/javascript" th:src="@{/plugins/layer/layer.js}"></script>
    <script type="text/javascript" th:src="@{/plugins/layui/layui.js}"></script>
    <link th:href="@{/css/theme.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css}" rel="stylesheet"
          type="text/css"/>
    <link th:href="@{/plugins/font_bxt4uwtd48c/iconfont.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/plugins/layui/css/layui.css}" rel="stylesheet" type="text/css">

</head>
<style>
    .form-inline {
        margin-top: 15px;
        margin-bottom: 15px;
    }

    input {
        margin-left: 15px;
    }

    .btn-primary {
        margin-left: 60px;
        width: 200px;
    }

    #comment {
        height: 100px;
        margin-left: 15px;
        width: 200px;
    }

    #commentTable {
        width: 1000px;
        margin-top: 10px;
        margin-bottom: 10px;
        text-align: center;
        font-size: 14px;
    }

    #commentTable th {
        text-align: center;
        font-weight: bold;
    }
</style>
<body>

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-question-circle" style="font-size:24px"></i> 今天吃什么
            <small>——午饭吃什么</small>
        </h3>
    </div>
    <div id="mealDiv" class="panel-body">
        <div class="form-inline">
            <label for="menu">可选项：</label>
            <button id="menu" class="btn btn-info" onclick="showMenu();"><i class="fa fa-book"
                                                                            style="font-size:20px"></i> 午饭菜单
            </button>
        </div>
        <div class="form-inline" style="display: none">
            <label for="meal">今天吃：</label>
            <span id="meal"></span>
        </div>
        <button id="showMeal" type="button" class="btn btn-primary" onclick="showMeal();">
            <i class="fa fa-coffee" style="font-size:20px"></i> 看 看 午 饭 吃 啥
        </button>
    </div>
</div>

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-question-circle" style="font-size:24px"></i> 今天吃什么
            <small>——晚饭吃什么</small>
        </h3>
    </div>
    <div id="supperDiv" class="panel-body">
        <div class="form-inline">
            <label for="menu2">可选项：</label>
            <button id="menu2" class="btn btn-info" onclick="showMenu2();"><i class="fa fa-book"
                                                                              style="font-size:20px"></i> 晚饭菜单
            </button>
        </div>
        <div class="form-inline" style="display: none">
            <label for="meal2">今天吃：</label>
            <span id="meal2"></span>
        </div>
        <button id="showMeal2" type="button" class="btn btn-primary" onclick="showMeal2();">
            <i class="fa fa-cutlery" style="font-size:20px"></i> 看 看 晚 饭 吃 啥
        </button>
    </div>
</div>

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-commenting-o" style="font-size:24px"></i> 留言板
        </h3>
    </div>
    <div id="commentDiv" class="panel-body">
        <button id="showComment" type="button" class="btn btn-primary" onclick="showComment();">
            <i class="fa fa-edit" style="font-size: 24px"></i> 点此留言，在下方展示
        </button>
        <form id="form1" method='POST' enctype="multipart/form-data">
            <input name="id" id="id" style="display: none;"/>
            <div class="form-inline">
                <label for="name">姓名：</label>
                <input id="name" class="form-control" disabled="disabled"/>
            </div>
            <div class="form-inline">
                <label for="comment" style="vertical-align: top">留言：</label>
                <textarea id="comment" class="form-control" disabled="disabled"></textarea>
            </div>
        </form>
        <div class="form-inline">
            <button id="submitComment" type="button" class="btn btn-primary" onclick="submitComment();">
                提交
            </button>
        </div>

        <br>

        <label for="commentTable">历史评论：</label>
        <table class="table table-striped table-hover table-bordered" id="commentTable">
            <thead>
            <tr class="info">
                <th>id</th>
                <th>姓名</th>
                <th>评论</th>
                <th>创建时间</th>
            </tr>
            </thead>
            <tbody id="tbs">
            <tr th:each="comment : ${commentList}">
                <td th:text="${comment.id}"></td>
                <td th:text="${comment.name}"></td>
                <td th:text="${comment.comment}"></td>
                <td th:text="${comment.createTime}"></td>
            </tr>
            </tbody>
        </table>
        <div id="page"></div>
    </div>

</div>

</body>
<script type="text/javascript" th:inline="javascript">

    $(function () {
        showPage();
    });

    function showPage() {
        layui.use('laypage', function () {
            var laypage = layui.laypage;
            //执行一个laypage实例
            laypage.render({
                elem: 'page' //elementID，不用加 #
                , count: [[${commentList.total}]] //数据总数，从服务端得到
                , limit: [[${commentList.pageSize}]]
                , limits: [5, 10, 20, 30]
                , curr: [[${commentList.pageNum}]]
                , layout: ['prev', 'page', 'next', 'limit', 'refresh']
                , theme: '#2B679C'
                , jump: function (obj, first) {
                    //obj包含了当前分页的所有参数，比如：
                    console.log(obj);
                    console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                    console.log(obj.limit); //得到每页显示的条数
                    // 首次不执行
                    if (!first) {
                        location.href = "queryComment?page=" + obj.curr + "&pageSize=" + obj.limit;
                    }
                }
            });
        });
    }


    function showMeal() {
        var random = Math.floor(Math.random() * 10);
        var result = random % 5;
        var icon = "";
        if (result === 0) {
            $("#meal").html("12块");
            icon = '<i class="iconfont icon-12" style="font-size:30px;"></i>'
        } else if (result === 1) {
            $("#meal").html("大鸡腿");
            icon = '<i class="iconfont icon-Drumsticks" style="font-size:30px;"></i>'
        } else if (result === 2) {
            $("#meal").html("煲仔饭");
            icon = '<i class="iconfont icon-baozifan" style="font-size:30px;"></i>'
        } else if (result === 3) {
            $("#meal").html("重庆面");
            icon = '<i class="iconfont icon-miantiao" style="font-size:30px;"></i>'
        } else if (result === 4) {
            $("#meal").html("香锅");
            icon = '<i class="iconfont icon-hotpot" style="font-size:30px;"></i>'
        }
        layer.open({
            type: 1
            , area: ['500px', '300px']
            , title: '<i class="fa fa-question-circle" style="font-size:24px"></i> 吃啥好呢？'
            , shade: 0.6
            , maxmin: true
            , anim: 4
            , content: '<div style="padding:50px;">' + icon + ' 中饭就吃【' + $("#meal").html() + '】吧</div>'
        });
    }

    function showMeal2() {
        var random = Math.floor(Math.random() * 10);
        var result = random % 6;
        var icon = "";
        if (result === 0) {
            $("#meal2").html("12块");
            icon = '<i class="iconfont icon-12" style="font-size:30px;"></i>'
        } else if (result === 1) {
            $("#meal2").html("大鸡腿");
            icon = '<i class="iconfont icon-Drumsticks" style="font-size:30px;"></i>'
        } else if (result === 2) {
            $("#meal2").html("煲仔饭");
            icon = '<i class="iconfont icon-baozifan" style="font-size:30px;"></i>'
        } else if (result === 3) {
            $("#meal2").html("重庆面");
            icon = '<i class="iconfont icon-miantiao" style="font-size:30px;"></i>'
        } else if (result === 4) {
            $("#meal2").html("香锅");
            icon = '<i class="iconfont icon-hotpot" style="font-size:30px;"></i>'
        } else if (result === 5) {
            $("#meal2").html("喝粥");
            icon = '<i class="iconfont icon-zhou" style="font-size:30px;"></i>'
        }
        layer.open({
            type: 1
            , area: ['500px', '300px']
            , title: '<i class="fa fa-question-circle" style="font-size:24px"></i> 吃啥好呢？'
            , shade: 0.6
            , maxmin: true
            , anim: 6
            , content: '<div style="padding:50px;">' + icon + ' 晚饭就吃【' + $("#meal2").html() + '】吧</div>'
        });
    }

    function showMenu() {
        layer.tips('12块 大鸡腿 煲仔饭 重庆面 香锅', '#menu', {
            tipsMore: true
        });

    }

    function showMenu2() {
        layer.tips('12块 大鸡腿 煲仔饭 重庆面 香锅 喝粥', '#menu2', {
            tipsMore: true
        });
    }

    function showComment() {
        layer.prompt({title: '请输入您的姓名，并确认', formType: 3}, function (name, index) {
            layer.close(index);
            layer.prompt({title: '请输入您的建议，并确认', formType: 2}, function (text, index) {
                layer.close(index);
                layer.msg('完毕！您的姓名：' + name + '<br>您写下了：' + text);
                $("#name").val(name);
                $("#comment").val(text);
            });
        });
    }

    // 提交
    function submitComment() {
        var id = $("#id").val();
        var name = $("#name").val();
        var comment = $("#comment").val();
        var data = {
            "id": id,
            "name": name,
            "comment": comment
        };
        $.ajax({
            type: "post",
            url: "saveComment",
            contentType: "application/json;charset=UTF-8",
            data: JSON.stringify(data),
            success: function () {
                console.log("保存成功");
                skip();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log('测试error');
                alert(XMLHttpRequest.status); // 状态码
                console.log(XMLHttpRequest.status);
                alert(errorThrown); // SyntaxError: Unexpected end of input
                console.log(errorThrown);
            }
        });
    }

    function skip() {
        location.href = 'queryComment?page=1&pageSize=5';
    }

</script>
</html>